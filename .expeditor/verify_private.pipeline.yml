# NOTE(ssd) 2019-02-06: Please explicitly document why a given job is
# here and not in the public verify pipeline. The more jobs we have in
# this pipeline, the harder it is for external contributors.

env:
  DOCKER_CONFIG: /var/lib/buildkite-agent/.docker
  HAB_BLDR_CHANNEL: "stable"
  HAB_STUDIO_SECRET_HAB_FALLBACK_CHANNEL: "stable"

expeditor:
  defaults:
    executor:
      docker:
        workdir: /go/src/github.com/chef/automate

steps:
  # Building hugo currently depends on a github token
  #     https://github.com/chef/chef-hugo-theme
  # which is currently private.

  # license scout requires github account access because we currently
  # rely on at least 2 private repositories.
  - label: license scout
    command:
      # here we reuse the license_scout.sh script used by expeditor to publish the manifest
      - .expeditor/license_scout.sh
    timeout_in_minutes: 20
    retry:
      automatic:
        limit: 1
    expeditor:
      secrets:
        GITHUB_TOKEN:
          account: github/chef
          field: token
      executor:
        docker:
