syntax = "proto3";

package chef.automate.api.infra_proxy.migrations;
option go_package = "github.com/chef/automate/api/external/infra_proxy/migrations";

import "google/api/annotations.proto";
import "external/annotations/iam/annotations.proto";

import "external/infra_proxy/migrations/request/migrations.proto";
import "external/infra_proxy/migrations/response/migrations.proto";

service  InfraProxyMigrationService {
    rpc GetMigrationStatus (infra_proxy.migrations.request.GetMigrationStatusRequest) returns (infra_proxy.migrations.response.GetMigrationStatusResponse) {
        option (google.api.http).get = "/api/v0/infra/servers/migrations/status/{migration_id}";
        option (chef.automate.api.iam.policy).resource = "infra:infraServers";
        option (chef.automate.api.iam.policy).action = "infra:infraServers:get";
    };

    rpc CancelMigration (infra_proxy.migrations.request.CancelMigrationRequest) returns (infra_proxy.migrations.response.CancelMigrationResponse) {
        option (google.api.http).get = "/api/v0/infra/servers/{server_id}/migrations/cancel_migration/{migration_id}";
        option (chef.automate.api.iam.policy).resource = "infra:infraServers:{server_id}:migrations:{migration_id}";
        option (chef.automate.api.iam.policy).action = "infra:infraServers:get";
    };

    rpc GetStagedData (infra_proxy.migrations.request.GetStagedDataRequest) returns (infra_proxy.migrations.response.GetStagedDataResponse) {
        option (google.api.http).get = "/api/v0/infra/servers/migrations/staged_data/{migration_id}";
        option (chef.automate.api.iam.policy).resource = "infra:infraServers:migrations:{migration_id}";
        option (chef.automate.api.iam.policy).action = "infra:infraServers:get";
    };

    rpc ConfirmPreview (infra_proxy.migrations.request.ConfirmPreviewRequest) returns (infra_proxy.migrations.response.ConfirmPreviewResponse) {
        option (google.api.http).get = "/api/v0/infra/servers/{server_id}/migrations/confirm_preview/{migration_id}";
        option (chef.automate.api.iam.policy).resource = "infra:infraServers:{server_id}:migrations:{migration_id}";
        option (chef.automate.api.iam.policy).action = "infra:infraServers:get";
    };
}
