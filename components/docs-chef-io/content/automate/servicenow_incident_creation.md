+++
title = "Chef Automate Incident Creation App"

draft = false

gh_repo = "automate"

[menu]
  [menu.automate]
    title = "Chef Automate Incident Creation App"
    parent = "automate/reference"
    identifier = "automate/reference/servicenow_incident_creation.md Chef Automate Incident Creation"
    weight = 40
+++

The Chef Automate Incident Creation app for ServiceNow, also called the Incident App, integrates Chef Automate with ServiceNow. This app is a ServiceNow-certified app available from the [ServiceNow](https://store.servicenow.com) store that enables you to automatically generate incidents in the ServiceNow Incident Management environment whenever you have any failures in your Chef-managed platform. These failures are due to either infrastructure automation updates or automated compliance check failures. This integration with ServiceNow allows you to capture all failures across your automated infrastructure for resolution and tracking purposes by improving the effectiveness of both ServiceNow and Chef Automate applications and help reduce the entire repercussions of any failure scenarios.

The Incident App exposes the REST API endpoint for communication between Chef Automate and the ServiceNow instance. Chef Automate sends HTTPS JSON notifications to the Incident App in a ServiceNow instance to creates and update incident failures.

![ServiceNow and Chef Automate Flow](/images/automate/SNOW_Automate_diagram.png)

## Key Features of Chef Automate Incident Creation App

* Incident management for infrastructure and compliance automation. Create ServiceNow incident tickets, alert and page operations for Chef failures or InSpec failures automatically. provide a resolution to the automation and compliance failures at the earliest and in concordance with a customer- or regulatory-mandated SLAs or OLAs.

* Intelligent data management and event de-duplication. Promotes Chef Automate as a central data aggregator and restricts opening of a new incident tickets for the repeated failures by updating relevant fields in ServiceNow, such as the time of last failure. This helps reduce alert noise, in contrast to non-Chef Automate approaches that send data directly from managed nodes to ServiceNow.

* Compliance-related integration opportunities with other capabilities on ServiceNow. Data stream of compliance events generated by the integration with ServiceNow leverages other applications on the ServiceNow platform. For example, governance and risk compliance (GRC) or security/incident management (SIEM) systems that have integrations with ServiceNow can now have access to this data. The data stream from InSpec through Chef Automate allows you to enhance the entire risk dashboard with real-time, continuous prioritized compliance events, rather than inundating the standardized data streams with meaningless, context-free data.

## Prerequisites

- The [Integration App]({{< relref "servicenow_integration" >}}) is already installed and configured.
- Your unique ServiceNow URL. It has the format: `https://ven12345.service-now.com`.
- Setting up the Incident App requires the `x_chef_automate.api` role to configure it. Ask an Integration App or ServiceNow administrator to enable this for you.

## Installation

Get the app from the [ServiceNow](https://store.servicenow.com) store and install it to your account from the ServiceNow Service Management dashboard. If you cannot find an application, you may have to request it from the ServiceNow Store.

## Setup

You can setup notifications for:

* Chef Infra Client failures `/api/x_chef_incident/client_run`
* Chef InSpec scan failures `/api/x_chef_incident/inspec_scan`

### Chef Infra Client Incidents

Follow these steps to report the failed client runs on nodes managed by Chef Automate:

1. Confirm that you have the `x_chef_automate.api` role.
2. Navigate to **Settings** from the **Chef Automate** menu.
3. Select the **Notifications** link from **General Settings** section on the left.
4. Select the **Create Notification** button.
5. Enter the following information, which are mandatory:
   * **Name**: a unique name for the failed client run notification.
   * **Webhook Type**: ServiceNow notification type. Possible values are **Slack**, **Webhook**, and **ServiceNow**.
   * **Failure Type**: select **Chef Infra Client run failures**.
   * **Webhook URL**: ServiceNow client run API address.
   * **Username** and **Password**: a ServiceNow user credentials with `x_chef_automate.api` role. When you select **Webhook** type as **ServiceNow**, the app displays the **Username** and **Password** fields.
6. Select the **Test Connectivity** button. The application checks that the values specified are correct and the connectivity between Chef Automate and the application establishes.

   A successful test displays the **Notification test connected successfully for cl** message for client run failures. Else, an error message shows detailing the connectivity or credentials issues and helps you resolve the error.

   ![Chef Automate Notification for CCR Failures](/images/automate/SNOW_CCR_Setup.png)

7. Select **Create Notification**. The app saves the configuration details for the Chef Automate client runs notifications.

### Chef InSpec Scan Incidents

Follow these steps to report the failed Chef InSpec scans on node managed by Chef Automate:

1. Confirm that you have the `x_chef_automate.api` role.
2. Navigate to **Settings** from the **Chef Automate** menu.
3. Select the **Notifications** link from **General Settings** section on the left.
4. Select the **Create Notification** button.
5. Enter the following information, which are mandatory:
   * **Name**: a unique name for the failed client run notification.
   * **Webhook Type**: ServiceNow notification type. Possible values are **Slack**, **Webhook**, and **ServiceNow**.
   * **Failure Type**: select **InSpec compliance scan failures**.
   * **Webhook URL**: ServiceNow Chef InSpec scan API address.
   * **Username** and **Password**: a ServiceNow user credentials with `x_chef_automate.api` role. When you select **Webhook** type as **ServiceNow**, the app displays the **Username** and **Password** fields.
6. Select the checkbox to send the compliance scan notification only when critical control failures occurs.
7. Select the **Test Connectivity** button. The application checks that the values specified are correct and the connectivity between Chef Automate and the application establishes.

   A successful test displays the **Notification test connected successfully for com** message for compliance scan failures. Else, an error message shows detailing the connectivity or credentials issues and helps you resolve the error.

   ![Chef Automate Notification for InSpec Scan Failures](/images/automate/SNOW_Scan_Setup.png)

8. Select **Create Notification**. The app saves the configuration for the Chef Automate InSpec scans notifications.

## Configuration

The Chef Automate Incident App has nine configurable **Application Properties**. You must have the `admin` or `x_chef_incident.admin` roles to change the default values in the **Application Properties**.

To change the Incident App properties:

1. Find **Chef Incidents** in ServiceNow
1. Select **Chef Incidents** > **Properties** from the navigation.
1. Enter your changes in the **Chef Incident Properties** form.
1. Select **Save**.

   {{< figure src="/images/automate/snow_incident_appproperties.png" alt="Chef Automate Incident Properties">}}

   ![ServiceNow Configuration Page](/images/automate/SNOW_config_page.png)

### Incident App Properties

`x_chef_incident.association`
: Used to associate a Chef Infra Client run record with an Incident record. The possible values are: `cookbook` and `node`. Default: `cookbook`.

Setting the value to `cookbook` creates an incident for the failed cookbook. All failing Chef Infra Client runs on nodes associates with the corresponding incident. `cookbook` is the default value as the number of nodes exceeds the number of cookbooks. The short description of the incident indicates the failed cookbook:

![CCR Failed Cookbook Description](/images/automate/SNOW_Failed_Cookbook.png)

The **Chef Infra Client runs** tab of the incident displays the associated client runs. Setting the value to `node` creates an incident for each failed node. All failing Chef Infra Client runs for a node associates with the corresponding incident. The short description of the incident indicates the failed node.

![CCR Failed Node Description](/images/automate/SNOW_Failed_Node_CCR.png)

`x_chef_incident.scan_association`

: Used to associate the Chef InSpec scan record with an incident record. The possible values are: `profile` and `node`. Deault: `profile`.

Setting the value to `profile` creates an incident for the failed Chef InSpec compliance profile. All Chef InSpec scans on failing nodes associates with the corresponding incident. `profile` is the default value as the number of nodes exceeds the number of profiles. The short description of the incident indicates the failed profile.

![Scan Failed Profile Description](/images/automate/SNOW_Failed_Profile_Scan.png)

The **Chef InSpec scans** tab of the incident displays the associated Chef InSpec scans. Setting the value to `node` creates an incident for each failed node. All Chef InSpec scans failing for a node associates with the corresponding incident. The short description of the incident indicates the failed node.

![Scan Failed Node Description](/images/automate/SNOW_Failed_Node_Scan.png)

`x_chef_incident.assigned_to`

: Used to set up the ServiceNow user ID to assign incidents raised by the application. The corresponding group assigns automatically to the incident if the user is in an assignment group. Default: `blank`.

`x_chef_incident.assignment_group`

: Used to set up a group rather than an individual user in the `x_chef_incident.assigned_to` property to assign the incident to a group. Default: `blank`.

`x_chef_incident.impact`

: Used to set an impact value in an incident raised by the application. Possible values are `1`, `2` or `3`. Default: `2`.

`x_chef_incident.urgency`

: Used to set an urgency value in an incident raised by the application. Possible values are `1`, `2` or `3`. Default: `2`.

`x_chef_incident.retention_days`

: Used to define number of days to maintain the Chef Infra Client run and Chef InSpec scan records in ServiceNow. Default: `30`.

The ServiceNow app deletes these records of the corresponding closed incidents, deleted incidents, and the removed incidents from the Chef Infra Client run or Chef InSpec scan record by a user update.

`x_chef_incident.logging.enabled`

: Used to flag the logging with **enable** or **disable** status. Once enabled, you can view the logs from the **Chef incidents** > **Logs** menu and the **System logs** > **Application logs** menu by authorized users. Default: `No`.

`x_chef_incident.logging.verbosity`

: Used to debug the data in ServiceNow. Enables the selected logging level and is visible in logs. The possible values are `debug`, `warn`, `info`, and `error`. Default: `error`.

## Uninstalling

To uninstall the Chef Automate Incident App:

1. Navigate to the **System Applications** > **Applications** in ServiceNow.
1. Open the **Downloads** tab and select the **Chef Automate Incident Creation**.
1. Navigate to **Related Links**.
1. Select **Uninstall**.
