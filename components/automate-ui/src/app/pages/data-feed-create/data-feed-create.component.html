<div ngClass="{slide : isSlideOpen}">
  <div class="sidenav-header-data-feed">
    <div *ngIf="integrationSelected">
      <chef-button class="arrow-btn" secondary (click)="returnToMenu()" data-cy="close-revision-id-button">
        <chef-icon>arrow_back</chef-icon>
      </chef-button>
    </div>
    
    <h1 slot="title" class="bolder-font" *ngIf="!integrationSelected">Choose a Data Feed Integration</h1>
    <h1 slot="title" class="bolder-font" data-cy="title-integration" *ngIf="integrationSelected">{{integTitle}}</h1>
    <chef-button class="close" secondary (click)="closeCreateSlider()" data-cy="close-feed-button">
      <chef-icon>close</chef-icon>
    </chef-button>
  </div>
  <app-notification
    *ngIf="testErrorGetter"
    type="error"
    timeout="5"
    (dismissed)="dismissNotification()">
    <span *ngIf="authSelected=='Username and Password'">Unable to connect: check URL, username and password.</span>
    <span *ngIf="authSelected=='Access Token'">Unable to connect: check Token Type (Prefix) and token.</span>
  </app-notification>
  <app-notification
    *ngIf="conflictErrorGetter"
    type="error"
    timeout="5"
    (dismissed)="dismissNotification()">
    <span>{{conflictErrorGetter}}</span>
  </app-notification>
  <app-notification
    *ngIf="testSuccessGetter"
    type="info"
    timeout="5"
    (dismissed)="dismissNotification()">
    Notification test connected successfully!
  </app-notification>
  <main *ngIf="!integrationSelected" data-cy="interation-menu">
    <div class="flex-container">
        <h2 class="bolder-font">Webhook Integration</h2>
        <div class="flex-child">
          <div class="card" (click)="selectIntegration(item.name)" *ngFor="let item of integrations.webhook" [attr.data-cy]="item.name">
            <img src="/assets/img/{{item.asset}}.png" alt="Avatar">
            <div class="container image-footer">
              <h3 class="bolder-font">{{item.name}}</h3> 
            </div>
            <div class="overlay" *ngIf="item.name!='ServiceNow'&&item.name!='Splunk'">
              <div class="text">Coming Soon</div>
            </div>
          </div>
        </div>
    </div>
    <div class="flex-container">
        <h2 class="bolder-font">Storage Integration </h2>
        <div class="flex-child">
          <div class="card" (click)="selectIntegration(item.name)" *ngFor="let item of integrations.storage">
            <img src="/assets/img/{{item.asset}}.png" alt="Avatar">
            <div class="container image-footer">
              <h3 class="bolder-font">{{item.name}}</h3> 
            </div>
            <div class="overlay">
              <div class="text">Coming Soon</div>
            </div>
          </div>
        </div>
    </div>
  </main>
  <main [class.hide]="!integrationSelected">
    <div class="flex-container2">
      <form [formGroup]="createForm" data-cy="data-feed-create-form">
        <div class="input-margin">
          <chef-form-field>
            <label>
              <span class="label">Name <span aria-hidden="true">*</span></span>
              <input
                chefInput
                #name
                formControlName="name"
                data-cy="add-name"
                type="text"
                id="name-input"
                autocomplete="off"/>
            </label>
            <chef-error
              *ngIf="(createForm.get('name').hasError('required') || createForm.get('name').hasError('pattern')) && createForm.get('name').dirty">
              Name is required.
            </chef-error>
          </chef-form-field>
        </div>
        <hr class="divider">
        <div class="input-margin">
          <chef-form-field>
            <label>
              <span class="label">URL<span aria-hidden="true">*</span></span>
              <input
                chefInput
                formControlName="url"
                data-cy="add-url"
                type="text"
                id="url-input"
                autocomplete="off"/>
            </label>
            <chef-error
              *ngIf="createForm.get('url').hasError('required') && createForm.get('url').dirty">
              URL is required.
            </chef-error>
            <chef-error
              *ngIf="createForm.get('url').hasError('pattern')">
              URL is invalid.
            </chef-error>
          </chef-form-field>
        </div>

        <div class="input-margin" *ngIf="showSelect">
          <div class="name-margin">
            <label for="version">Authentication</label>
            <div class="version-dropdown">
              <chef-select #ty [value]="authSelected" (change)="selectChangeHandlers(ty.value)" data-cy="select-auth-type">
                <chef-option value="Access Token" data-cy="select-access-token">Access Token</chef-option>
                <chef-option value="Username and Password" data-cy="select-username-password">Username and Password</chef-option>
              </chef-select>
            </div>
          </div>
        </div>

        <div class="input-margin" *ngIf="authSelected=='Access Token'">
          <chef-form-field>
            <label>
              <span class="label">Token Type (Prefix)<span aria-hidden="true">*</span></span>
              <div class="input-and-btn">
                <input
                  chefInput
                  formControlName="tokenType" 
                  type="text"
                  data-cy="add-token-type"
                  id="token-type-input"
                  autocomplete="off"
                  [readonly]="tokenToggle"
                />
                <chef-button secondary data-cy="toggle-type" (click)="toggleTokenType()">
                  Edit
                </chef-button>
              </div>
            </label>
          </chef-form-field>
        </div>

        <div class="input-margin" *ngIf="authSelected=='Access Token'">
          <chef-form-field>
            <label>
              <span class="label">Token <span aria-hidden="true">*</span></span>
              <input
                chefInput
                formControlName="token" 
                type="text"
                data-cy="add-token"
                id="token-input"
                autocomplete="off"
              />
            </label>
            <chef-error
              *ngIf="createForm.get('token').hasError('required') && createForm.get('token').dirty">
              token is required.
            </chef-error>
            <chef-error
              *ngIf="createForm.get('token').hasError('pattern')">
              token is invalid.
            </chef-error>
          </chef-form-field>
        </div>

        <div class="input-margin" *ngIf="authSelected=='Username and Password'">
          <chef-form-field>
            <label>
              <span class="label">Username <span aria-hidden="true">*</span></span>
              <input
                chefInput
                formControlName="username" 
                type="text"
                data-cy="add-username"
                id="username-input"
                autocomplete="off"
              />
            </label>
            <chef-error
              *ngIf="createForm.get('username').hasError('required') && createForm.get('username').dirty">
              Username is required.
            </chef-error>
            <chef-error
              *ngIf="createForm.get('username').hasError('pattern')">
              Username is invalid.
            </chef-error>
          </chef-form-field>
        </div>

        <div class="input-margin" *ngIf="authSelected=='Username and Password'">
          <chef-form-field>
            <label>
              <span class="label">Password <span aria-hidden="true">*</span></span>
              <input
                chefInput
                formControlName="password" 
                type="password"
                data-cy="add-password"
                id="password-input"
                autocomplete="off"
              />
            </label>
            <chef-error
              *ngIf="createForm.get('password').hasError('required') && createForm.get('password').dirty">
              Password is required.
            </chef-error>
            <chef-error
              *ngIf="createForm.get('password').hasError('pattern')">
              Password is invalid.
            </chef-error>
          </chef-form-field>
        </div>
        
        <div class="input-margin">
          <div class="button-bar">
            <chef-button data-cy="test-button" id="testConnection" (click)="testConnection()" primary [disabled]="!validateForm()">
              <span *ngIf="!testDoneGetter">Test Connection</span>
              <chef-loading-spinner *ngIf="testDoneGetter"></chef-loading-spinner>
              <span *ngIf="testDoneGetter">Testing...</span>
            </chef-button>
          </div>
        </div>
        <hr>
        <div class="button-bar">
          <chef-button id="cancel-server-popup" (click)="returnToMenu()" tertiary>Cancel</chef-button>
          <chef-button [disabled]="!validateForm()"
            primary
            data-cy="add-button"
            id="create-button-object-modal"
            (click)="saveDestination()"
            >
            <chef-loading-spinner *ngIf="saveDoneGetter"></chef-loading-spinner>
            <span *ngIf="saveDoneGetter">Saving...</span>
            <span *ngIf="!saveDoneGetter">Save</span>
          </chef-button>
        </div>
      </form>
    </div>
  </main>
</div>
