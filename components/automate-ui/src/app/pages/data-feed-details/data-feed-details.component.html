<div class="content-container">
  <div class="container">
    <main>
      <chef-breadcrumbs>
        <chef-breadcrumb [link]="['/settings/data-feeds']">Data Feed</chef-breadcrumb>
        {{ destination?.name }}
      </chef-breadcrumbs>
      <chef-page-header>
        <chef-heading>{{ destination?.name }}</chef-heading>
        <table>
          <thead>
            <tr class="detail-row">
              <th class="header-column">URL</th>
            </tr>
          </thead>
          <tbody>
            <tr class="detail-row">
              <td class="header-column" data-cy="destination-url">{{ destination?.url }}</td>
            </tr>
          </tbody>
        </table>
        <chef-tab-selector [value]="tabValue">
          <chef-option value='details'>Details</chef-option>
        </chef-tab-selector>
      </chef-page-header>
      <section class="page-body">
        <form [formGroup]="updateForm">
          <chef-form-field>
            <label>Name <span aria-hidden="true">*</span></label>
            <input chefInput formControlName="name" type="text" [resetOrigin]="saveSuccessful" autocomplete="off" data-cy="name-input"/>
            <chef-error *ngIf="(nameCtrl.hasError('required') || nameCtrl.hasError('pattern')) && nameCtrl.dirty">
              Name is required.
            </chef-error>
          </chef-form-field>
          <chef-form-field>
            <label>Data Feed URL <span aria-hidden="true">*</span></label>
            <input chefInput formControlName="url" type="text" [resetOrigin]="saveSuccessful" autocomplete="off" data-cy="url-input"/>
            <chef-error *ngIf="urlCtrl.hasError('required')">
              Data Feed URL is required.
            </chef-error>
            <chef-error *ngIf="urlCtrl.hasError('pattern')">
              Data Feed URL is invalid.
            </chef-error>
          </chef-form-field>
        </form>
        <chef-modal label="url-modal-label" [visible]="urlStatusModalVisible" (closeModal)="closeModal('url')">
          <div class="status-modal">
            <ng-container *ngIf="hookStatus === urlState.Failure">
              <div class="status-icon failure">
                <chef-icon>warning</chef-icon>
              </div>
              <h3 id="url-modal-label" class="status-heading display3 failure">
                We were unable to connect to your destination {{ destination.name }}.
              </h3>
              <p>Please update your destination details and try again.</p>
              <chef-button primary (click)="closeModal('url')">Close</chef-button>
            </ng-container>
            <ng-container *ngIf="hookStatus === urlState.Success">
              <div class="status-icon success">
                <chef-icon>done</chef-icon>
              </div>
              <h3 class="status-heading display3">Data feed test connected successfully for {{ destination.name }}!</h3>
              <chef-button primary (click)="closeModal('url')">Close</chef-button>
            </ng-container>
          </div>
        </chef-modal>
        <div>
          <chef-button secondary [disabled]="testInProgress" (click)="sendTestForDataFeedUrl()">
            <chef-loading-spinner *ngIf="testInProgress"></chef-loading-spinner>
            <span *ngIf="testInProgress">Testing...</span>
            <span *ngIf="!testInProgress">Test Data Feed</span>
          </chef-button>
          <chef-button primary [disabled]="saveInProgress || !updateForm.valid || !this.updateForm.dirty" (click)="saveDataFeed()">
            <chef-loading-spinner *ngIf="saveInProgress"></chef-loading-spinner>
            <span *ngIf="saveInProgress">Saving...</span>
            <span *ngIf="!saveInProgress">Save</span>
          </chef-button>
          <span id="saved-note" *ngIf="saveSuccessful && !updateForm.dirty">All changes saved.</span>
        </div>
      </section>
    </main>
  </div>
</div>
