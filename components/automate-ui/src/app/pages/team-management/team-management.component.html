<app-admin-sidebar></app-admin-sidebar>
<chef-loading-spinner *ngIf="loading$ | async" size='50' fixed></chef-loading-spinner>

<div class="container">
  <main>
    <chef-page-header>
      <chef-heading>Teams</chef-heading>
      <chef-subheading>Chef Automate only displays local teams.</chef-subheading>
    </chef-page-header>

    <app-create-v1-team-modal
      [visible]="createV1TeamModalVisible"
      [creating]="creatingTeam"
      [conflictErrorEvent]="conflictErrorEvent"
      objectNoun="team"
      [createForm]="createV1TeamForm"
      (close)="closeCreateModal()"
      (createClicked)="createV1Team()">
    </app-create-v1-team-modal>

    <app-create-object-modal
      [visible]="createModalVisible"
      [creating]="creatingTeam"
      [conflictErrorEvent]="conflictErrorEvent"
      objectNoun="team"
      [createForm]="createTeamForm"
      (close)="closeCreateModal()"
      (createClicked)="createTeam()">
    </app-create-object-modal>

    <app-delete-object-modal
      [visible]="deleteModalVisible"
      objectNoun="team"
      [objectName]="isV1 ? teamToDelete?.id : teamToDelete?.name"
      (close)="closeModal()"
      (deleteClicked)="deleteTeam()">
    </app-delete-object-modal>

    <div class="page-body">
      <section>
        <chef-toolbar>
          <app-authorized [allOf]="['/auth/teams', 'post']">
            <chef-button *ngIf="(iamMajorVersion$ | async) as version" primary (click)="openCreateModal(version)">Create Team</chef-button>
          </app-authorized>
        </chef-toolbar>
        <div id="table-container">
          <chef-table>
            <chef-thead>
              <chef-tr>
                <chef-th class="id-column">
                  <span>Name</span>
                </chef-th>
                <chef-th class="name-column">
                  <span *ngIf="isV1">Description</span>
                  <span *ngIf="!isV1">ID</span>
                </chef-th>
                <chef-th class="button-column"></chef-th>
              </chef-tr>
            </chef-thead>
            <chef-tbody>
              <chef-tr *ngFor="let team of sortedTeams$ | async">
                <chef-td class="id-column">
                  <!-- we must continue to use the guid as the identifier for teams while on v1 -->
                  <a *ngIf="isV1" [routerLink]="['/settings/teams', team.guid]">{{ team.id }}</a>
                  <a *ngIf="!isV1" [routerLink]="['/settings/teams', team.id]">{{ team.name }}</a>
                </chef-td>
                <chef-td class="name-column">
                  <span *ngIf="isV1">{{ team.name }}</span>
                  <span *ngIf="!isV1">{{ team.id }}</span>
                </chef-td>
                <chef-td class="button-column">
                  <!-- <app-authorized [allOf]="[`/auth/teams/${team.id}`, 'delete']"> -->
                  <chef-control-menu>
                    <chef-option (click)="startTeamDelete(team)">Delete Team</chef-option>
                  </chef-control-menu>
                  <!-- <app-authorized -->
                </chef-td>
              </chef-tr>
            </chef-tbody>
          </chef-table>
        </div>
      </section>
    </div>
  </main>
</div>
