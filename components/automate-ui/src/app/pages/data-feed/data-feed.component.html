<div class="content-container">
  <div *ngIf="permissionDenied" class="permission-denied-banner">
    <p>You do not have permission to view everything on this page.</p>
    <p>Please contact an administrator for permission.</p>
  </div>
  <div class="container">
    <main>
      <chef-page-header>
        <chef-heading>Data Feeds</chef-heading>
        <chef-subheading>Data Feed for bulk client data and compliance reports.</chef-subheading>
        <app-create-data-feed-modal
          [visible]="createModalVisible"
          [creating]="creatingDataFeed"
          [sending]="sendingDataFeed"
          [createForm]="createDataFeedForm"
          (close)="closeCreateModal()"
          [conflictErrorEvent]="conflictErrorEvent"
          (createClicked)="createDataFeed()">
        </app-create-data-feed-modal>
        <app-delete-object-modal
          [visible]="deleteModalVisible"
          objectNoun="data-feed"
          [objectName]="DataFeedToDelete?.name"
          (close)="closeDeleteModal()"
          (deleteClicked)="deleteDataFeed()"
          objectAction="Delete">
        </app-delete-object-modal>
      </chef-page-header>

      <div class="page-body">
        <chef-alert type="error" *ngIf="errorLoading">There was an error loading destinations.</chef-alert>

        <chef-toolbar>
          <div *ngIf="(sortedDestinations$ | async)?.length === 0" class="empty-state">
            <p>Create a data feed to get started!</p>
          </div>
          <div [ngClass]="(sortedDestinations$ | async)?.length > 0 ? '' : 'empty-state'">
            <!-- <chef-button primary [routerLink]="['/settings/data-feed/form']">Create Data Feed</chef-button> -->
            <chef-button primary (click)="openCreateModal()">Create Data Feed</chef-button>
          </div>
        </chef-toolbar>

        <chef-table-new>
          <chef-table-header>
            <chef-table-row>
              <chef-table-header-cell>Name</chef-table-header-cell>
              <chef-table-header-cell class="three-dot-column"></chef-table-header-cell>
            </chef-table-row>
          </chef-table-header>
          <chef-table-body>
            <chef-table-row *ngFor= "let destination of sortedDestinations$ | async">
              <chef-table-cell>
                <a [routerLink]="['/settings/data-feed/form', destination.id]">{{ destination.name }}</a>
              </chef-table-cell>
              <chef-table-cell class="three-dot-column">
                <mat-select panelClass="chef-control-menu" id="menu-{{destination.id}}">
                  <mat-option (onSelectionChange)="startDataFeedDelete($event, destination)" data-cy="remove-data-feed">Delete Data Feed</mat-option>
                </mat-select>
              </chef-table-cell>
            </chef-table-row>
          </chef-table-body>
        </chef-table-new>
      </div>
    </main>
  </div>
</div>
