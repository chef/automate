#!/bin/bash
basePath=$1
echo " ================= Getting certs from vault using ==============="
echo $OPENSEARCH_ROOT_CA_PEM
echo $OPENSEARCH_ADMIN_PEM
echo $OPENSEARCH_ADMIN_KEY_PEM
echo $OPENSEARCH_NODE1_PEM
echo $OPENSEARCH_NODE1_KEY_PEM


cat <<EOF >> $basePath/default.toml
# root pem cert that signed the two cert/key pairs below
rootCA = """-----BEGIN CERTIFICATE-----
MIIDqzCCApOgAwIBAgIUMUG0kbGT5s8Vo415aNfii81CzRcwDQYJKoZIhvcNAQEL
BQAwZTELMAkGA1UEBhMCVVMxEzARBgNVBAgMCldhc2hpbmd0b24xEDAOBgNVBAcM
B1NlYXR0bGUxGjAYBgNVBAoMEUNoZWYgU29mdHdhcmUgSW5jMRMwEQYDVQQDDApj
aGVmcm9vdGNhMB4XDTIyMDYwMTA3MzMwMFoXDTI1MDUzMTA3MzMwMFowZTELMAkG
A1UEBhMCVVMxEzARBgNVBAgMCldhc2hpbmd0b24xEDAOBgNVBAcMB1NlYXR0bGUx
GjAYBgNVBAoMEUNoZWYgU29mdHdhcmUgSW5jMRMwEQYDVQQDDApjaGVmcm9vdGNh
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA4aKz6j+Otgeg+oZSsHtq
z5Phyb2cWr+CdbLb2qZA9ZDcCjEzkxvuvI6QBScF9feVk7YVXg59DXlHJRP7AHx5
nG5iQmND0jUUQGjyZfKTWO8Z9F8D/w0HAFOk4LTvVR/AAC6f9PpxjaydfSzkh5cc
NxeotjlkYUgh6D7fFma9gRtjX4a36miA5FqCv0Lkwrk9tXHdDk6skdjBvCS0URnq
zDfyTcK7R/L/iaGYtY43c8tB8eHKwK+ZQ2fR4V90YI3xkbkwr6j0efZyU2Kp/03r
2nDtFQXHwwuj6Sg465DJB9MQ01IbR30NUjJiFGOJaxdRlhsEeWWNL8BELQuGpJe9
VQIDAQABo1MwUTAdBgNVHQ4EFgQU3XAfDSRK1wCTf0wiDjlR4m06FCQwHwYDVR0j
BBgwFoAU3XAfDSRK1wCTf0wiDjlR4m06FCQwDwYDVR0TAQH/BAUwAwEB/zANBgkq
hkiG9w0BAQsFAAOCAQEAVTiFfpOzYfXzQxTrl4VxctdQJI52jPjWP55PmK/IO7sb
n/DKzRNnvn7mN3EDGmshh5i76/hoGA09pK4SdAwJl2QIRJSu3ChH4QCf7n/iIYww
SxhpOp9QtJA5Cyu4MoemK49Lld/7xf3Qdt1pOgEMz4AGLt2uwS5SdmR4OkSPHqt0
Qq/lgSoiawVOd0UE+5Ocu5S472du/REcVS4KkQdkzZaw9Q7OGIN9G0X0wb0V3UZs
R2XuApUUaGOl0s0a1uNMv3WkyOrCGS3JkIem6+R59pfliaz6FPcQD+0oXI2gjG3c
H4VFwOis/oT/2FwYM89j7XZPDpRfUUGMHD53W7YPHA==
-----END CERTIFICATE-----"""
EOF
 
cat <<EOF >> $basePath/default.toml
# Certificate used for admin actions against https://9200
admin_cert = """-----BEGIN CERTIFICATE-----
MIIDeDCCAmCgAwIBAgIUDsi0qPmptSvcCCXXJ2Fm1pFmvz8wDQYJKoZIhvcNAQEL
BQAwZTELMAkGA1UEBhMCVVMxEzARBgNVBAgMCldhc2hpbmd0b24xEDAOBgNVBAcM
B1NlYXR0bGUxGjAYBgNVBAoMEUNoZWYgU29mdHdhcmUgSW5jMRMwEQYDVQQDDApj
aGVmcm9vdGNhMB4XDTIyMDYwMTA3MzMwMFoXDTI1MDUzMTA3MzMwMFowZDELMAkG
A1UEBhMCVVMxEzARBgNVBAgMCldhc2hpbmd0b24xEDAOBgNVBAcMB1NlYXR0bGUx
GjAYBgNVBAoMEUNoZWYgU29mdHdhcmUgSW5jMRIwEAYDVQQDDAljaGVmYWRtaW4w
ggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCmAPx686ekg1SaD1FRmkLW
uIt4i7aoOFm/pAd7teD6AH4Xa3pa3w8ePNljz92xc4FciXakmNoBhiWl1gGff6xk
zyEJkrj1+EYChIMo82Uu+/WBPVLevhNMQkWYL/tG2UGJNYKUtvKeUoNS9KFLc+6r
0riD/fnP08+3SlK6o+ZzQAbqwQPAGjfLeGjduNPDJgvulbt98sPS5HPyme2PUk+z
Tg2YEoCI5U/op+OcC7S0HyjiG8IkfU300gpH70iwqDLdZ5KSnonKaxxhtEs5MR3W
FP3wwh51Dbs43qF39nZMQfUCdOn6VCdH6ZlMv8CKvbpXm7w0TkARUky4FJlnUl2X
AgMBAAGjITAfMB0GA1UdJQQWMBQGCCsGAQUFBwMCBggrBgEFBQcDATANBgkqhkiG
9w0BAQsFAAOCAQEAQ1GYvQvZHSLd0dVQq91T+yBP15HUuhd/sU4HXCDWNrlpp28f
AWNwKW5L+p9Xt7DLVOFIl9WR1QowNa6h1E3sDZyAzM2m0wBq9qGzBosJzG+wQkhM
8v0Rx6ODVw5yy3LxUEEyMQwYH++/aFz3dB+EbH74XFgPYGq4VcpZA5dkFYdzAELA
T/34HKUpMV6KCI+DQRFKSBOZQnN1WsJs9zcxkl3FIGL7H4IifbmAwzSGS+zDRiHt
Qpc8KJQvH5IQPHam452H5RguC4EaFBJjOe1gg487/dj+kZRRGw+MnFo4Lpp+Ce32
yx68zYBUuwdHlQEYkDjTQVceKl68CpOKhE2tQw==
-----END CERTIFICATE-----"""
EOF
 
cat <<EOF >> $basePath/default.toml
# the private key associated with the above pem cert
admin_key = """-----BEGIN PRIVATE KEY-----
MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCmAPx686ekg1Sa
D1FRmkLWuIt4i7aoOFm/pAd7teD6AH4Xa3pa3w8ePNljz92xc4FciXakmNoBhiWl
1gGff6xkzyEJkrj1+EYChIMo82Uu+/WBPVLevhNMQkWYL/tG2UGJNYKUtvKeUoNS
9KFLc+6r0riD/fnP08+3SlK6o+ZzQAbqwQPAGjfLeGjduNPDJgvulbt98sPS5HPy
me2PUk+zTg2YEoCI5U/op+OcC7S0HyjiG8IkfU300gpH70iwqDLdZ5KSnonKaxxh
tEs5MR3WFP3wwh51Dbs43qF39nZMQfUCdOn6VCdH6ZlMv8CKvbpXm7w0TkARUky4
FJlnUl2XAgMBAAECggEATgAkonkeinSTKhiMczVytoXcMvYjC4P+18dxJLXfUlks
5kBAK7an2eNpmjavypOlcx+8ObcAqLqpsfSOqq1JCc0xjtf8RMc1zjUJlBJZtuv4
/ZMc/0B8vNZe8RWKkk2/N4OHKe2UrsPCpRYBO/zrZp0KyipqWTcDYPJxUPV2cSwg
u8S+O6duDMteON4Ngo4mhsF2OsS2IRKe5dUptNZE9Zr/c7lJiapRkCu77YOSIud1
Q9IhPOuhTOmZ5oGiCPiupFhHfbxIc9dTtQFy+q0ngBr3Wao3wH3A6yrSJkfNceF6
EepFwo9S3ENr6e+dKyYEYRqLn5y5xp0tWxnd6ftAoQKBgQDVYDoa+WPzNc3eW21I
uOnLWsGSYpYOMjR9yfQPAWcehEXQW138UV2KXJpPMyr1SIj1Uce3D5fcSfoi93yO
7Bo9t1NI6bcrwCdTyTYwDE4uob3HJcDjYrndLkKq14fuAuiqzIfcbin7h3YyLtHn
QKb5EM2nbdl/ZSHqt9uv4eXTuQKBgQDHKjaejTyQRGIsbwGErv3G7fp1yXOdDirZ
X9TG4Mk1gfdSNsNnR1ftOxIVsBgIvVwbS3/Hc9O33ERNZplC+3Mb3RSr6AUxpWBV
0cL9h28UI2kxInskVk0jcy0aUJuXwHzJwissMzhO7+abbfk6lP+hnDVPTLJK9i+m
yGnJN4kDzwKBgELrfQ28rZY3h6t3LR0jsV9vxUnt1XX6VPAmiH60R+0QOv0Pyrg5
pIaiaFryh0SKTTnzPhmxsEUMhoC08cG5VrmIZ3x0oFf+WdczQeVr1pFVdLmio44t
BnHR8mK2WhFRpDr9DpcZjd0vLOisOnS2mCeBF56tGwuTYkHFDAdrZ7MxAoGAdwGK
UYMjRTEXWGWcCqRlj5BzsB4Hrzjf8bOJeKyojghyt/VxHS1MJLy/OaZXNiGv/79F
QvC6+YnsZjOAML3/Mg8QYwfo0pl2ztDgKo3ambXvDSUFX9kRjrUrpiW0UyD5b7VO
BsM0SjafHRDBc3fEp9SnJhM2FgS0xHvMeids/5ECgYEAoMz3QW4sslG3cgXEDhFw
Vu6UUMNuGW2b9ZedgSafkp6pXVVwMMf1eRN3Wz50MIDmMPnlYy0qjf5ooP3kG8F2
KrhkYVqH3Iuchwz/JpT+fSfoRsheUVPSLJ44Kd5PldlUD5YEPlyWMrH+I49wLXdG
fiRKmwfrHJg+yKmkdvA/ezY=
-----END PRIVATE KEY-----"""
EOF
 
cat <<EOF >> $basePath/default.toml
# Certificate used for intracluster ssl on port 9300
ssl_cert = """-----BEGIN CERTIFICATE-----
MIIDdzCCAl+gAwIBAgIUDsi0qPmptSvcCCXXJ2Fm1pFmv0AwDQYJKoZIhvcNAQEL
BQAwZTELMAkGA1UEBhMCVVMxEzARBgNVBAgMCldhc2hpbmd0b24xEDAOBgNVBAcM
B1NlYXR0bGUxGjAYBgNVBAoMEUNoZWYgU29mdHdhcmUgSW5jMRMwEQYDVQQDDApj
aGVmcm9vdGNhMB4XDTIyMDYwMTA3MzMwMVoXDTI1MDUzMTA3MzMwMVowYzELMAkG
A1UEBhMCVVMxEzARBgNVBAgMCldhc2hpbmd0b24xEDAOBgNVBAcMB1NlYXR0bGUx
GjAYBgNVBAoMEUNoZWYgU29mdHdhcmUgSW5jMREwDwYDVQQDDAhjaGVmbm9kZTCC
ASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAM5iKA88y2M7T+OSD2vPTPFJ
mSoKHEyZ3U8qW1ZL9ORY9c5yLpHazWIQ48S1Ad/OeggrrZG7JWOjBY1aYuXWgPe8
ZQ9nS3mUdEu3QjW52zJb5Tp8qO7MJGVXFNaBGoKDSvIuGpnlruNYLiwJbTj0mzkC
RKvSXCg7iOszHt72VUkfRQM59iXh3LjNup6TPVMmW8Iamze7/NB9DMz4Ixjkknfc
O9v1Fp2E+GJonpbIPBZGItBelMOH0g/EIBMASl3GX4+eBLndhcdjsdtzEV/fJE6H
wgMtJGahb+17ztLK54dkZKQ7ES7WVlIq3Bfw+yepqaI6tnfIprqSaPclmeW+asUC
AwEAAaMhMB8wHQYDVR0lBBYwFAYIKwYBBQUHAwIGCCsGAQUFBwMBMA0GCSqGSIb3
DQEBCwUAA4IBAQBYhcyhj/PeVIcV7uWTK7lZxfEjEwG2Pydch+z8ElVuT8iYjuSE
UMvJTjrX5topd+u9P1INUJAmjyXI8kJ42AoozCsH79iMwkX51O6Ri8GsAufDVeDf
uTlNCxpnE2O1W1/l9UVUloTGW515KguPcC4xYdNwA6scN8rlhTtH8vvBteDUE+fq
ucRUikrbokEfgzHl3la0QlvQ8JnKprOAxK2eme815IK75ygpcLWKjveHFdC2VknY
wbdG/4UzmsZbI2q5raa9nY3pSJ/kQ3IYg0lRyEAtIC1LsDw7aW1+Vlw5VR4arHRo
LOEtF2OEtA1uREZpdtoViv7K36rTwDYwMDS+
-----END CERTIFICATE-----"""
EOF
 
cat <<EOF >> $basePath/default.toml
# the private key associated with the above pem cert
ssl_key = """-----BEGIN PRIVATE KEY-----
MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDOYigPPMtjO0/j
kg9rz0zxSZkqChxMmd1PKltWS/TkWPXOci6R2s1iEOPEtQHfznoIK62RuyVjowWN
WmLl1oD3vGUPZ0t5lHRLt0I1udsyW+U6fKjuzCRlVxTWgRqCg0ryLhqZ5a7jWC4s
CW049Js5AkSr0lwoO4jrMx7e9lVJH0UDOfYl4dy4zbqekz1TJlvCGps3u/zQfQzM
+CMY5JJ33Dvb9RadhPhiaJ6WyDwWRiLQXpTDh9IPxCATAEpdxl+PngS53YXHY7Hb
cxFf3yROh8IDLSRmoW/te87SyueHZGSkOxEu1lZSKtwX8PsnqamiOrZ3yKa6kmj3
JZnlvmrFAgMBAAECggEBAJMQRtN00smHPko/jlWYho95jnbydW/wRE9hM2yu+3as
HZxaqOyuKaQzvNoy0X8VtseTuD8cSGxTgmVTfx2gWI4v5SOwy4t7SdOaZse6BIRC
D3o50nc3aMf94Y9ot+dAf2tLhxEbJiBCecRPg1EOnH1nLF/zqk/Q/KP87YabqfJL
2hV/+ZbUtRzyC88X7zgfHOIPjKF6qZYj2rBF9d6J/nyk4+RGTQXuYMRXRfMa/+Vg
PQA8vHLOF1ZGbDfLkATcRFy8bVaCHbESRJuVxx377mK3fsZJwP3en3dsANkurJFU
pf0hdW2rL+XoKyBgkd5ZC1XMW6nLBJkhnyuDkWSLwIECgYEA77vdAyXOBIrykR0P
TnG7d79h3iccYtMEJt3+yK+i/z4xvJ4kUyujXfld+DC2EpudGvAfcPqswMcEfASU
z7/S7Fjs1DoNqhzVQ2AbLtiXv6gDDqtxRhiQsRebDrCMsy3ak9S+qwx1po/GbAI4
+Jyd1Ej7nFbr1jaRDE5v/NCkpWkCgYEA3GMAglhMyiiZIp1SCTyZlw/JsgeounW8
KpCeJW6sRGeKhjU63K6JAKRVH8ZN4BCZAslHgyBlqFavRP1iNGz8aVzijuE3LYv9
djClbTKDeL5BVQCMZmMeHRx26A6C2VR3bCeogKCLG2p2w2e6aNyC/5vRswPQ9fHN
9oQTdP+3Iv0CgYBhsaoARWCuQz1UW4ZITlq6Eti8Ii4UK6/uctsIR2LiJyM3nS5q
Ykch3aQopxkbfiTIvH/jl5Pcv32ZWHiYLLC0tgxU9A9renKCEWEidwtoA/yy9rSj
fxE/ycHbe6Dqx83iHnlQ1TQAm2idzU4QKiq7Pr6iWF2lHvl/DVvfp9rguQKBgHeX
NZCFr+3HiAmziu++Na42gAGejF3aQ6hpX5f6bXqVISNgwTc9ctSpWBPs/RdIim9r
n+W079UgbO2n/eFq/rGCGOLlrZaGr5yyGyKdVaBwxW0F5iotQQsVBiU4sqKSZleH
UbWy6KmQ5S92Gz6J4oAoIuvcd0ju1RAfbZuAo/VVAoGBAOPXGcUiDIonDKVPTB9l
W7AYWGXC2qaSCzM5B0A6+Nb4ZqKs1zjtjT1a2JC+EHY9alFo2ccBvkjux8gQmPyX
uR4wX6ynzUxYIzs6aTPbvxe6d8U8lGK1LpsgLFPxBb9BKIHQ9d62/QUOrb75n2/H
DEJQGW+rrJ+d9XyEozpuIv+I
-----END PRIVATE KEY-----"""
EOF
